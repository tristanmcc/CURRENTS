


<%- include('partials/header'); -%>

<form>
    <h2>Transact</h2>
    <label for = "alias">beneficiary alias</label>
    <input id="alias" type = "text" name="alias" required />
    <div class="alias error"></div>
    <label for = "amount">amount</label>
    <input id="amount" type = "number" name="amount" required />
    <div class="amount error"></div>
    
    <button>Submit</button>
</form>


<script>
    const form  = document.querySelector('form');
    
    const aliasError = document.querySelector('.alias.error');
    const amountError = document.querySelector('.amount.error');
    

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        //reset errors

        
        
        aliasError.textContent = '';
        amountError.textContent = '';
            
        //get the values
        
        const alias = form.alias.value;
        const amount = form.amount.value;
        

        try {
            
            const res = await fetch('/transact', {
                method: 'POST',
                body: JSON.stringify({ 
                    alias: alias, 
                    amount: amount}),
                    
                    headers: { 'Content-Type': 'application/json'}

            });
            
            const data = await res.json();
            
            if (data.errors) {
                
                
                aliasError.textContent = data.errors.password;
                amountError.textContent = data.errors.amount;
                console.log('there is an error')
            }
            if (data) {
                
                console.log(data)
                window.alert("Transaction successful");
                location.assign('/');
            } else {
                console.log('error')
                window.alert("Transaction failed");
            }
            
        } catch (err) {
            console.log(err);
            window.alert("Insufficient spending capacity.");

        } 

    })
</script>
<%- include('partials/footer'); -%>